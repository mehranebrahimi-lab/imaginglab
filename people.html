<!DOCTYPE html>
<html>

<head>
    <title>ImagingLab.ca, People</title>
    <meta content="text/html; charset=utf-8" http-equiv="content-type">
    <meta name="description" content="ImagingLab, Mehran Ebrahimi, UOIT">
    <meta name="author" content="Kamyar Nazeri">
    <meta name="contact" content="kamyar.nzr@gmail.com">

    <link rel="stylesheet" type="text/css" media="all" href="inland.css">
    <script type="text/javascript" src="resources/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="resources/jquery.nivo.slider.js"></script>
    <script type="text/javascript" src="resources/site.js"></script>
</head>

<body>
    <div id="wrapper960" class="clearfix">
        <div id="header" class="clearfix shadow">
            <div style="color: rgb(0, 0, 172);" id="sitetitle" class="clearfix">
                <h1><a href=".">ImagingLab.ca</a></h1>
            </div>
            <div id="nav" class="clearfix">
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a class="current" href="people.html">People</a></li>
                    <li><a href="research.html">Research</a></li>
                    <li><a href="publications.html">Publications</a></li>
                    <li><a href="teaching.html">Teaching</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </div>
        </div>

        <div class="slider-wrapper">
            <div id="slider" class="nivoSlider">
                <img src="images/slider1.jpg" alt="">
                <img src="images/slider2.jpg" alt="">
                <img src="images/slider3.jpg" alt="">
                <img src="images/slider4.jpg" alt="">
            </div>
        </div>

        <div id="content" class="clearfix shadow" style="padding: 10px 10px;">
            <div class="table" style="width:100%; padding-top: 10px">

                <!-- Person detail-->
                <div id="content_person" class="person">
                    <div id="content_person_detail" style="display:none">
                        <div id="content_person_header">
                            <div style="display:table-cell;">
                                <img id="content_person_image" />
                            </div>
                            <div style="display:table-cell; padding-left:10px; padding-right:10xp">
                                <h1 id="content_person_name">[NAME]</h1>
                                <h4 id="content_person_title" style="display:inline-block; padding-right:10px">[TITLE]</h4>
                                <span id="content_person_duration">[START-END]</span>
                                <div id="content_person_email">[EMAIL]</div>
                                <div id="content_person_research">[RESEARCH INTERESTS]</div>
                            </div>
                        </div>
                        <br />
                        <div id="content_person_description">[DESCRIPTION]</div>
                        <br />
                        <div id="content_person_publications">
                            <br />
                            <h3 style="display: inline; padding-right:15px">Publications</h3>
                            <span>
                                <a href="#" id="a_year"> By Year </a>
                                |
                                <a href="#" id="a_type"> By Type </a>
                            </span>
                            <br />
                            <br />
                            <div id="content_person_publications_content"></div>
                        </div>
                    </div>
                </div>

                <!-- Members list -->
                <div class="table-cell" style="width: 280px; height:600px; vertical-align:top">
                    <h2 style="display: inline; padding-right:15px;">Members</h2>
                    <span>
                        <a href="#" id="a_all" people-type="1"> All </a>
                        |
                        <a href="#" id="a_active" people-type="2"> Active </a>
                        |
                        <a href="#" id="a_alumni" people-type="3"> Alumni </a>
                    </span>
                    <div style="border-bottom: solid 1px #B6B6B6; height:10px"></div>
                    <div id="content_people" style="display:none"></div>
                </div>
            </div>
        </div>
        <div id="footer" class="shadow">
            <p>
                <a href="http://www.uoit.ca">
                    <img style="width: 78px; height: 25px;" longdesc="http://www.uoit.ca" title="UOIT" alt="UOIT" src="images/logo-uoit1.jpg" />
                </a>
                <br>
                ©ImagingLab.ca, Dr. Mehran Ebrahimi
            </p>
        </div>
    </div>

    <script type="text/javascript">

        (function () {

            var currentPerson = null;

            page.ready(function (data) {

                $('a[people-type]').click(function (e) {
                    bindPeople($(this).attr('people-type'));
                    e.preventDefault();
                });

                // bind window history change event
                $(window).bind('popstate', function (e) {
                    var state = e.originalEvent.state;
                    if (state && state.name) {
                        bindPerson(state);
                    }
                });

                bindPeople(1);
            });

            // type: 1: All, 2: Active, 3: Alumni
            function bindPeople(type) {
                type = parseInt(type);
                $("a").removeClass('selected');
                $('a[people-type=' + type + ']').addClass('selected');

                var people = page.data.people;
                var current = people[0];
                var content = $('<div>');

                function fixname(name) {
                    return (name || '').replace(/ /ig, '_').toLowerCase();
                };

                people.sort(function (a, b) {
                    return a.order - b.order;
                });


                for (var i = 0; i < people.length; i++) {
                    var person = people[i];

                    // select person when query string parameter is passed
                    if (window.location.href.toUpperCase().indexOf(fixname(person.name).toUpperCase()) != -1)
                        current = person;

                    if ((type == 2 & person.alumnus) || type == 3 & !person.alumnus)
                        continue;

                    if (!person.visible)
                        continue;

                    var persoan_link = $('<a>').attr('href', '#' + fixname(person.name)).click(function (e) {
                        e.preventDefault();
                        e.stopPropagation();
                        bindPerson(this.person);

                        // save history
                        var url = location.protocol + '//' + location.host + location.pathname + '#' + fixname(this.person.name);
                        window.history.pushState(this.person, "", url);
                    });
                    persoan_link.get(0).person = person;


                    var person_content = $('<div>').addClass('people-item');
                    var person_image = $('<img>').attr('src', person.photo || 'images/noimage.png');
                    var person_title = $('<div>');
                    var person_name = $('<h4>' + person.name + (type != 3 && person.alumnus ? ' <label style="font-size:14px">(alumnus)</label>' : '') + '</h4>');
                    var person_position = $('<span>' + person.position + '</span></div>');

                    persoan_link.append(person_content);
                    person_content.append(person_image).append(person_title);
                    person_title.append(person_name).append(person_position);

                    content.append(persoan_link);
                }

                $('#content_people').fadeOut('fast', function () {
                    $(this).empty().hide().append(content).fadeIn()
                });

                bindPerson(current);
                window.history.pushState(current, "");
            };


            function bindPerson(person) {
                if (person == currentPerson) return;
                currentPerson = person;

                document.title = 'ImagingLab.ca, ' + person.name;

                var photo = person.photo || 'images/noimage.png';
                var name = person.name;
                var title = person.title || person.position;
                var research = person.research ? ('<span style="font-weight: bold">Research interests: </span>' + person.research) : '';
                var description = person.description;
                var duration = '';
                var email = person.email ? ('<span style="font-weight: bold">Contact: </span><a href="mailto:' + person.email + '">' + person.email + '</a>') : '';
                var publications = [];

                for (var i = 0; i < page.data.publications.length; i++) {
                    var pub = page.data.publications[i];

                    if (!pub.peoplePageVisible || !pub.people)
                        continue;

                    for (var j = 0; j < pub.people.length; j++) {
                        if (pub.people[j] == person.id) {
                            publications.push(pub);
                            break;
                        }
                    }
                }

                if (person.start) {
                    duration += '[';
                    duration += person.start;
                    duration += ' - ';
                    duration += (person.end ? person.end : 'Present');
                    duration += ']';
                }

                $('#content_person_detail').fadeOut('fast', function () {
                    $('#content_person_image').attr('src', photo);
                    $('#content_person_name').html(name);
                    $('#content_person_title').html(title);
                    $('#content_person_email').html(email);
                    $('#content_person_duration').html(duration);
                    $('#content_person_research').html(research);
                    $('#content_person_description').html(description);
                    $('#content_person_publications').toggle(publications.length > 0);
                    bindPublications(publications, true);

                    $('#content_person_detail').fadeIn();
                    page.render();
                });
            };


            function bindPublications(pubs, by_year) {

                if (pubs.length == 0) return;

                var content = $('<div>').css({ 'padding-left': '10px' });
                var types = page.data.publicationTypes;

                pubs.sort(function (a, b) {
                    return by_year ? (b.year - a.year) : (types.indexOf(a.type) - types.indexOf(b.type));
                });

                $('#a_year')
                    .toggleClass('selected', by_year)
                    .unbind()
                    .click(function (e) {
                        bindPublications(pubs, true);
                        e.preventDefault();
                    });

                $('#a_type')
                    .toggleClass('selected', !by_year)
                    .unbind()
                    .click(function (e) {
                        bindPublications(pubs, false);
                        e.preventDefault();
                    });



                var keys = {};
                var groups = [];

                for (var i = 0; i < pubs.length; i++) {
                    var item = pubs[i];
                    var key = item[by_year ? 'year' : 'type'];

                    if (!item.visible) continue;

                    if (!keys[key]) {
                        var grp = [];
                        grp.key = key;
                        keys[key] = grp;
                        groups.push(grp);
                    }
                    keys[key].push(item);
                }

                for (var i = 0; i < groups.length; i++) {
                    var grp = groups[i];
                    grp.sort(function (a, b) { return a.order - b.order });
                    bindPublicationsGroup(content, grp.key, grp);
                }

                $('#content_person_publications_content').fadeOut('fast', function () {
                    $(this).empty().append(content).fadeIn();
                });
            }


            function bindPublicationsGroup(parent, title, items) {
                if (items.length == 0) return;
                var item = $('<div>');
                var header = $('<a href="#"></a>').appendTo(item);
                var headertext = $('<h3 class="link"> ' + title + '</h3>').appendTo(header);
                var pubdiv = $("<div>").appendTo(item);
                var ul = $("<ul>").css({ 'list-style': 'none' }).appendTo(pubdiv);
                var open = true;

                header.click(function (e) {
                    open = !open;
                    pubdiv.slideToggle();
                    headertext.html((open ? ' ' : '» ') + title);
                    e.preventDefault();
                });

                for (var i = 0; i < items.length; i++) {
                    var p = items[i];
                    var li = $('<li>').appendTo(ul);
                    if (p.code) li.append('[<span id="' + p.code + '" style="font-weight:bold">' + p.code + '</span>] ');
                    if (p.authors) li.append(p.authors);
                    if (p.year) li.append(' (' + p.year + '). ');
                    li.append(p.title);
                    if (p.type != title) li.append(' (<span STYLE="font-style:italic; font-size: 11px">' + p.type + '</span>)');
                    li.append('<br />');

                    var links = $('<div>').appendTo(li);

                    if (p.pdf) {
                        links.append('<a href="' + p.pdf + '" target="_blank" title="PDF"> [PDF] </a>');
                    }

                    if (p.url) {
                        links.append('<a href="' + p.url + '" target="_blank" title="URL"> [URL] </a>');
                    }

                    if (p.bibtex) {
                        (function () {
                            var bibtex = p.bibtex.replace(/\n/ig, "<br/>");
                            var bibtexLink = $('<a href="javascript:void(0)" title="Bibtex"> [Bibtex] </a>').appendTo(links);
                            var bintexContent = $('<div>').addClass('bibtex').appendTo(links);

                            bibtexLink.click(function () {
                                bintexContent.html(bibtex);
                                bintexContent.slideToggle();
                            });
                        })();
                    }

                    li.append('<br />');
                };

                item.appendTo(parent);
            }
        })();

    </script>
</body>

</html>